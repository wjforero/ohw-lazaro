/**
 * $Revision: 1.2 $
 * $Date: 2003/03/18 12:36:05 $
 */

#ifndef MARCHINGCUBES_H
#define MARCHINGCUBES_H

#include "base.h"

CGL_BEGIN

template <class TAffineSpace>
class MarchingCubes {
public:	
	/**
	 */
	typedef typename TAffineSpace::TAffineVector TVector;
	/**
	 */
	typedef typename TAffineSpace::TAffinePoint TPoint;
public:
  /**
	 */
	//enum VERTEX{LDB,LDF,LUB,LUF,RDB,RDF,RUB,RUF};
  enum VERTEX{LDB,RDB,RDF,LDF,LUB,RUB,RUF,LUF};
	/**
	 */	
  enum EDGE{DB,RD,DF,LD,UB,RU,UF,LU,LB,RB,RF,LF};
	/**
	 */
	enum FACE{L,R,D,U,B,F};
private:
	/**
	 */
	MarchingCubes() {
	}
public:
	/**
	 */
	static void processCell(const TPoint& pos, const TVector& size, const unsigned char& code, vector<TPoint*>& output) {
		int* cases = getCase(code);
		TPoint val;
		TVector x(size.gethx()/2,0,0);
		TVector y(0,size.gethy()/2,0);
    TVector z(0,0,size.gethz()/2);
		unsigned int j=0;
		while(cases[j]!=-1) {
      val = pos;
			switch(cases[j]) {
				case LD:  val = pos+z; break;
        case LU:  val = pos+z+y+y; break;
				case LB:  val = pos+y; break;
				case LF:  val = pos+y+z+z; break;
        case RD:  val = pos+x+x+z; break;
        case RU:  val = pos+x+x+y+y+z; break;
				case RB:  val = pos+x+x+y; break;
				case RF:  val = pos+x+x+y+z+z; break;
        case DB:  val = pos+x; break;
        case DF:  val = pos+x+z+z; break;
				case UB:  val = pos+x+y+y; break;
				case UF:  val = pos+x+y+y+z+z; break;

			}
      //cout<<"edge: "<<cases[j]<<" - point: "<<val<<endl;
			output.push_back(new TPoint(val));
			j++;
		}    
	}
public:
	/** retorna la fila de la tabla para el caso indicado.
   * @param index el caso que se esta buscando en la tabla.
   *   se recibe según la notación de samet y se mapea a la notación
   *   de la tabla original de marching cubes.
	 */
	static int* getCase(const unsigned char& index) {
		return m_trianglescase[ m_casemap[index] ];
	}
private:
	/**
	 */
	static int m_trianglescase[256][16];
  /**
	 */
	static unsigned int m_casemap[256];
};


// For each of the possible vertex states listed in this table there is a
// specific triangulation of the edge intersection points.  The table lists
// all of them in the form of 0-5 edge triples with the list terminated by
// the invalid value -1.  For example: triTable[3] list the 2 triangles
// formed when cube[0] and cube[1] are inside of the surface, but the rest of
// the cube is not. 
template <class TPVolumetricSpace>
int MarchingCubes<TPVolumetricSpace>::m_trianglescase[256][16]={
  {-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 0*/
  { 0,  8,  3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 1*/
  { 0,  1,  9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 2*/
  { 1,  8,  3,  9,  8,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 3*/
  { 1,  2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 4*/
  { 0,  8,  3,  1,  2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 5*/
  { 9,  2, 10,  0,  2,  9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 6*/
  { 2,  8,  3,  2, 10,  8, 10,  9,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 7*/
  { 3, 11,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 8*/
  { 0, 11,  2,  8, 11,  0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 9*/
  { 1,  9,  0,  2,  3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 10*/
  { 1, 11,  2,  1,  9, 11,  9,  8, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 11*/
  { 3, 10,  1, 11, 10,  3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 12*/
  { 0, 10,  1,  0,  8, 10,  8, 11, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 13*/
  { 3,  9,  0,  3, 11,  9, 11, 10,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 14*/
  { 9,  8, 10, 10,  8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 15*/
  { 4,  7,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 16*/
  { 4,  3,  0,  7,  3,  4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 17*/
  { 0,  1,  9,  8,  4,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 18*/
  { 4,  1,  9,  4,  7,  1,  7,  3,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 19*/
  { 1,  2, 10,  8,  4,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 20*/
  { 3,  4,  7,  3,  0,  4,  1,  2, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 21*/
  { 9,  2, 10,  9,  0,  2,  8,  4,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 22*/
  { 2, 10,  9,  2,  9,  7,  2,  7,  3,  7,  9,  4, -1, -1, -1, -1}, /*caso 23*/
  { 8,  4,  7,  3, 11,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 24*/
  {11,  4,  7, 11,  2,  4,  2,  0,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 25*/
  { 9,  0,  1,  8,  4,  7,  2,  3, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 26*/
  { 4,  7, 11,  9,  4, 11,  9, 11,  2,  9,  2,  1, -1, -1, -1, -1}, /*caso 27*/
  { 3, 10,  1,  3, 11, 10,  7,  8,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 28*/
  { 1, 11, 10,  1,  4, 11,  1,  0,  4,  7, 11,  4, -1, -1, -1, -1}, /*caso 29*/
  { 4,  7,  8,  9,  0, 11,  9, 11, 10, 11,  0,  3, -1, -1, -1, -1}, /*caso 30*/
  { 4,  7, 11,  4, 11,  9,  9, 11, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 31*/
  { 9,  5,  4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 32*/
  { 9,  5,  4,  0,  8,  3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 33*/
  { 0,  5,  4,  1,  5,  0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 34*/
  { 8,  5,  4,  8,  3,  5,  3,  1,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 35*/
  { 1,  2, 10,  9,  5,  4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 36*/
  { 3,  0,  8,  1,  2, 10,  4,  9,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 37*/
  { 5,  2, 10,  5,  4,  2,  4,  0,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 38*/
  { 2, 10,  5,  3,  2,  5,  3,  5,  4,  3,  4,  8, -1, -1, -1, -1}, /*caso 39*/
  { 9,  5,  4,  2,  3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 40*/
  { 0, 11,  2,  0,  8, 11,  4,  9,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 41*/
  { 0,  5,  4,  0,  1,  5,  2,  3, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 42*/
  { 2,  1,  5,  2,  5,  8,  2,  8, 11,  4,  8,  5, -1, -1, -1, -1}, /*caso 43*/
  {10,  3, 11, 10,  1,  3,  9,  5,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 44*/
  { 4,  9,  5,  0,  8,  1,  8, 10,  1,  8, 11, 10, -1, -1, -1, -1}, /*caso 45*/
  { 5,  4,  0,  5,  0, 11,  5, 11, 10, 11,  0,  3, -1, -1, -1, -1}, /*caso 46*/
  { 5,  4,  8,  5,  8, 10, 10,  8, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 47*/
  { 9,  7,  8,  5,  7,  9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 48*/
  { 9,  3,  0,  9,  5,  3,  5,  7,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 49*/
  { 0,  7,  8,  0,  1,  7,  1,  5,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 50*/
  { 1,  5,  3,  3,  5,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 51*/
  { 9,  7,  8,  9,  5,  7, 10,  1,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 52*/
  {10,  1,  2,  9,  5,  0,  5,  3,  0,  5,  7,  3, -1, -1, -1, -1}, /*caso 53*/
  { 8,  0,  2,  8,  2,  5,  8,  5,  7, 10,  5,  2, -1, -1, -1, -1}, /*caso 54*/
  { 2, 10,  5,  2,  5,  3,  3,  5,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 55*/
  { 7,  9,  5,  7,  8,  9,  3, 11,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 56*/
  { 9,  5,  7,  9,  7,  2,  9,  2,  0,  2,  7, 11, -1, -1, -1, -1}, /*caso 57*/
  { 2,  3, 11,  0,  1,  8,  1,  7,  8,  1,  5,  7, -1, -1, -1, -1}, /*caso 58*/
  {11,  2,  1, 11,  1,  7,  7,  1,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 59*/
  { 9,  5,  8,  8,  5,  7, 10,  1,  3, 10,  3, 11, -1, -1, -1, -1}, /*caso 60*/
  { 5,  7,  0,  5,  0,  9,  7, 11,  0,  1,  0, 10, 11, 10,  0, -1}, /*caso 61*/
  {11, 10,  0, 11,  0,  3, 10,  5,  0,  8,  0,  7,  5,  7,  0, -1}, /*caso 62*/
  {11, 10,  5,  7, 11,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 63*/
  {10,  6,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 64*/
  { 0,  8,  3,  5, 10,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 65*/
  { 9,  0,  1,  5, 10,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 66*/
  { 1,  8,  3,  1,  9,  8,  5, 10,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 67*/
  { 1,  6,  5,  2,  6,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 68*/
  { 1,  6,  5,  1,  2,  6,  3,  0,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 69*/
  { 9,  6,  5,  9,  0,  6,  0,  2,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 70*/
  { 5,  9,  8,  5,  8,  2,  5,  2,  6,  3,  2,  8, -1, -1, -1, -1}, /*caso 71*/
  { 2,  3, 11, 10,  6,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 72*/
  {11,  0,  8, 11,  2,  0, 10,  6,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 73*/
  { 0,  1,  9,  2,  3, 11,  5, 10,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 74*/
  { 5, 10,  6,  1,  9,  2,  9, 11,  2,  9,  8, 11, -1, -1, -1, -1}, /*caso 75*/
  { 6,  3, 11,  6,  5,  3,  5,  1,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 76*/
  { 0,  8, 11,  0, 11,  5,  0,  5,  1,  5, 11,  6, -1, -1, -1, -1}, /*caso 77*/
  { 3, 11,  6,  0,  3,  6,  0,  6,  5,  0,  5,  9, -1, -1, -1, -1}, /*caso 78*/
  { 6,  5,  9,  6,  9, 11, 11,  9,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 79*/
  { 5, 10,  6,  4,  7,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 80*/
  { 4,  3,  0,  4,  7,  3,  6,  5, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 81*/
  { 1,  9,  0,  5, 10,  6,  8,  4,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 82*/
  {10,  6,  5,  1,  9,  7,  1,  7,  3,  7,  9,  4, -1, -1, -1, -1}, /*caso 83*/
  { 6,  1,  2,  6,  5,  1,  4,  7,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 84*/
  { 1,  2,  5,  5,  2,  6,  3,  0,  4,  3,  4,  7, -1, -1, -1, -1}, /*caso 85*/
  { 8,  4,  7,  9,  0,  5,  0,  6,  5,  0,  2,  6, -1, -1, -1, -1}, /*caso 86*/
  { 7,  3,  9,  7,  9,  4,  3,  2,  9,  5,  9,  6,  2,  6,  9, -1}, /*caso 87*/
  { 3, 11,  2,  7,  8,  4, 10,  6,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 88*/
  { 5, 10,  6,  4,  7,  2,  4,  2,  0,  2,  7, 11, -1, -1, -1, -1}, /*caso 89*/
  { 0,  1,  9,  4,  7,  8,  2,  3, 11,  5, 10,  6, -1, -1, -1, -1}, /*caso 90*/
  { 9,  2,  1,  9, 11,  2,  9,  4, 11,  7, 11,  4,  5, 10,  6, -1}, /*caso 91*/
  { 8,  4,  7,  3, 11,  5,  3,  5,  1,  5, 11,  6, -1, -1, -1, -1}, /*caso 92*/
  { 5,  1, 11,  5, 11,  6,  1,  0, 11,  7, 11,  4,  0,  4, 11, -1}, /*caso 93*/
  { 0,  5,  9,  0,  6,  5,  0,  3,  6, 11,  6,  3,  8,  4,  7, -1}, /*caso 94*/
  { 6,  5,  9,  6,  9, 11,  4,  7,  9,  7, 11,  9, -1, -1, -1, -1}, /*caso 95*/
  {10,  4,  9,  6,  4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 96*/
  { 4, 10,  6,  4,  9, 10,  0,  8,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 97*/
  {10,  0,  1, 10,  6,  0,  6,  4,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 98*/
  { 8,  3,  1,  8,  1,  6,  8,  6,  4,  6,  1, 10, -1, -1, -1, -1}, /*caso 99*/
  { 1,  4,  9,  1,  2,  4,  2,  6,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 100*/
  { 3,  0,  8,  1,  2,  9,  2,  4,  9,  2,  6,  4, -1, -1, -1, -1}, /*caso 101*/
  { 0,  2,  4,  4,  2,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 102*/
  { 8,  3,  2,  8,  2,  4,  4,  2,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 103*/
  {10,  4,  9, 10,  6,  4, 11,  2,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 104*/
  { 0,  8,  2,  2,  8, 11,  4,  9, 10,  4, 10,  6, -1, -1, -1, -1}, /*caso 105*/
  { 3, 11,  2,  0,  1,  6,  0,  6,  4,  6,  1, 10, -1, -1, -1, -1}, /*caso 106*/
  { 6,  4,  1,  6,  1, 10,  4,  8,  1,  2,  1, 11,  8, 11,  1, -1}, /*caso 107*/
  { 9,  6,  4,  9,  3,  6,  9,  1,  3, 11,  6,  3, -1, -1, -1, -1}, /*caso 108*/
  { 8, 11,  1,  8,  1,  0, 11,  6,  1,  9,  1,  4,  6,  4,  1, -1}, /*caso 109*/
  { 3, 11,  6,  3,  6,  0,  0,  6,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 110*/
  { 6,  4,  8, 11,  6,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 111*/
  { 7, 10,  6,  7,  8, 10,  8,  9, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 112*/
  { 0,  7,  3,  0, 10,  7,  0,  9, 10,  6,  7, 10, -1, -1, -1, -1}, /*caso 113*/
  {10,  6,  7,  1, 10,  7,  1,  7,  8,  1,  8,  0, -1, -1, -1, -1}, /*caso 114*/
  {10,  6,  7, 10,  7,  1,  1,  7,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 115*/
  { 1,  2,  6,  1,  6,  8,  1,  8,  9,  8,  6,  7, -1, -1, -1, -1}, /*caso 116*/
  { 2,  6,  9,  2,  9,  1,  6,  7,  9,  0,  9,  3,  7,  3,  9, -1}, /*caso 117*/
  { 7,  8,  0,  7,  0,  6,  6,  0,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 118*/
  { 7,  3,  2,  6,  7,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 119*/
  { 2,  3, 11, 10,  6,  8, 10,  8,  9,  8,  6,  7, -1, -1, -1, -1}, /*caso 120*/
  { 2,  0,  7,  2,  7, 11,  0,  9,  7,  6,  7, 10,  9, 10,  7, -1}, /*caso 121*/
  { 1,  8,  0,  1,  7,  8,  1, 10,  7,  6,  7, 10,  2,  3, 11, -1}, /*caso 122*/
  {11,  2,  1, 11,  1,  7, 10,  6,  1,  6,  7,  1, -1, -1, -1, -1}, /*caso 123*/
  { 8,  9,  6,  8,  6,  7,  9,  1,  6, 11,  6,  3,  1,  3,  6, -1}, /*caso 124*/
  { 0,  9,  1, 11,  6,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 125*/
  { 7,  8,  0,  7,  0,  6,  3, 11,  0, 11,  6,  0, -1, -1, -1, -1}, /*caso 126*/
  { 7, 11,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 127*/
  { 7,  6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 128*/
  { 3,  0,  8, 11,  7,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 129*/
  { 0,  1,  9, 11,  7,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 130*/
  { 8,  1,  9,  8,  3,  1, 11,  7,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 131*/
  {10,  1,  2,  6, 11,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 132*/
  { 1,  2, 10,  3,  0,  8,  6, 11,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 133*/
  { 2,  9,  0,  2, 10,  9,  6, 11,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 134*/
  { 6, 11,  7,  2, 10,  3, 10,  8,  3, 10,  9,  8, -1, -1, -1, -1}, /*caso 135*/
  { 7,  2,  3,  6,  2,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 136*/
  { 7,  0,  8,  7,  6,  0,  6,  2,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 137*/
  { 2,  7,  6,  2,  3,  7,  0,  1,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 138*/
  { 1,  6,  2,  1,  8,  6,  1,  9,  8,  8,  7,  6, -1, -1, -1, -1}, /*caso 139*/
  {10,  7,  6, 10,  1,  7,  1,  3,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 140*/
  {10,  7,  6,  1,  7, 10,  1,  8,  7,  1,  0,  8, -1, -1, -1, -1}, /*caso 141*/
  { 0,  3,  7,  0,  7, 10,  0, 10,  9,  6, 10,  7, -1, -1, -1, -1}, /*caso 142*/
  { 7,  6, 10,  7, 10,  8,  8, 10,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 143*/
  { 6,  8,  4, 11,  8,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 144*/
  { 3,  6, 11,  3,  0,  6,  0,  4,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 145*/
  { 8,  6, 11,  8,  4,  6,  9,  0,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 146*/
  { 9,  4,  6,  9,  6,  3,  9,  3,  1, 11,  3,  6, -1, -1, -1, -1}, /*caso 147*/
  { 6,  8,  4,  6, 11,  8,  2, 10,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 148*/
  { 1,  2, 10,  3,  0, 11,  0,  6, 11,  0,  4,  6, -1, -1, -1, -1}, /*caso 149*/
  { 4, 11,  8,  4,  6, 11,  0,  2,  9,  2, 10,  9, -1, -1, -1, -1}, /*caso 150*/
  {10,  9,  3, 10,  3,  2,  9,  4,  3, 11,  3,  6,  4,  6,  3, -1}, /*caso 151*/
  { 8,  2,  3,  8,  4,  2,  4,  6,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 152*/
  { 0,  4,  2,  4,  6,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 153*/
  { 1,  9,  0,  2,  3,  4,  2,  4,  6,  4,  3,  8, -1, -1, -1, -1}, /*caso 154*/
  { 1,  9,  4,  1,  4,  2,  2,  4,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 155*/
  { 8,  1,  3,  8,  6,  1,  8,  4,  6,  6, 10,  1, -1, -1, -1, -1}, /*caso 156*/
  {10,  1,  0, 10,  0,  6,  6,  0,  4, -1, -1, -1, -1, -1, -1, -1}, /*caso 157*/
  { 4,  6,  3,  4,  3,  8,  6, 10,  3,  0,  3,  9, 10,  9,  3, -1}, /*caso 158*/
  {10,  9,  4,  6, 10,  4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 159*/
  { 4,  9,  5,  7,  6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 160*/
  { 0,  8,  3,  4,  9,  5, 11,  7,  6, -1, -1, -1, -1, -1, -1, -1}, /*caso 161*/
  { 5,  0,  1,  5,  4,  0,  7,  6, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 162*/
  {11,  7,  6,  8,  3,  4,  3,  5,  4,  3,  1,  5, -1, -1, -1, -1}, /*caso 163*/
  { 9,  5,  4, 10,  1,  2,  7,  6, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 164*/
  { 6, 11,  7,  1,  2, 10,  0,  8,  3,  4,  9,  5, -1, -1, -1, -1}, /*caso 165*/
  { 7,  6, 11,  5,  4, 10,  4,  2, 10,  4,  0,  2, -1, -1, -1, -1}, /*caso 166*/
  { 3,  4,  8,  3,  5,  4,  3,  2,  5, 10,  5,  2, 11,  7,  6, -1}, /*caso 167*/
  { 7,  2,  3,  7,  6,  2,  5,  4,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 168*/
  { 9,  5,  4,  0,  8,  6,  0,  6,  2,  6,  8,  7, -1, -1, -1, -1}, /*caso 169*/
  { 3,  6,  2,  3,  7,  6,  1,  5,  0,  5,  4,  0, -1, -1, -1, -1}, /*caso 170*/
  { 6,  2,  8,  6,  8,  7,  2,  1,  8,  4,  8,  5,  1,  5,  8, -1}, /*caso 171*/
  { 9,  5,  4, 10,  1,  6,  1,  7,  6,  1,  3,  7, -1, -1, -1, -1}, /*caso 172*/
  { 1,  6, 10,  1,  7,  6,  1,  0,  7,  8,  7,  0,  9,  5,  4, -1}, /*caso 173*/
  { 4,  0, 10,  4, 10,  5,  0,  3, 10,  6, 10,  7,  3,  7, 10, -1}, /*caso 174*/
  { 7,  6, 10,  7, 10,  8,  5,  4, 10,  4,  8, 10, -1, -1, -1, -1}, /*caso 175*/
  { 6,  9,  5,  6, 11,  9, 11,  8,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 176*/
  { 3,  6, 11,  0,  6,  3,  0,  5,  6,  0,  9,  5, -1, -1, -1, -1}, /*caso 177*/
  { 0, 11,  8,  0,  5, 11,  0,  1,  5,  5,  6, 11, -1, -1, -1, -1}, /*caso 178*/
  { 6, 11,  3,  6,  3,  5,  5,  3,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 179*/
  { 1,  2, 10,  9,  5, 11,  9, 11,  8, 11,  5,  6, -1, -1, -1, -1}, /*caso 180*/
  { 0, 11,  3,  0,  6, 11,  0,  9,  6,  5,  6,  9,  1,  2, 10, -1}, /*caso 181*/
  {11,  8,  5, 11,  5,  6,  8,  0,  5, 10,  5,  2,  0,  2,  5, -1}, /*caso 182*/
  { 6, 11,  3,  6,  3,  5,  2, 10,  3, 10,  5,  3, -1, -1, -1, -1}, /*caso 183*/
  { 5,  8,  9,  5,  2,  8,  5,  6,  2,  3,  8,  2, -1, -1, -1, -1}, /*caso 184*/
  { 9,  5,  6,  9,  6,  0,  0,  6,  2, -1, -1, -1, -1, -1, -1, -1}, /*caso 185*/
  { 1,  5,  8,  1,  8,  0,  5,  6,  8,  3,  8,  2,  6,  2,  8, -1}, /*caso 186*/
  { 1,  5,  6,  2,  1,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 187*/
  { 1,  3,  6,  1,  6, 10,  3,  8,  6,  5,  6,  9,  8,  9,  6, -1}, /*caso 188*/
  {10,  1,  0, 10,  0,  6,  9,  5,  0,  5,  6,  0, -1, -1, -1, -1}, /*caso 189*/
  { 0,  3,  8,  5,  6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 190*/
  {10,  5,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 191*/
  {11,  5, 10,  7,  5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 192*/
  {11,  5, 10, 11,  7,  5,  8,  3,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 193*/
  { 5, 11,  7,  5, 10, 11,  1,  9,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 194*/
  {10,  7,  5, 10, 11,  7,  9,  8,  1,  8,  3,  1, -1, -1, -1, -1}, /*caso 195*/
  {11,  1,  2, 11,  7,  1,  7,  5,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 196*/
  { 0,  8,  3,  1,  2,  7,  1,  7,  5,  7,  2, 11, -1, -1, -1, -1}, /*caso 197*/
  { 9,  7,  5,  9,  2,  7,  9,  0,  2,  2, 11,  7, -1, -1, -1, -1}, /*caso 198*/
  { 7,  5,  2,  7,  2, 11,  5,  9,  2,  3,  2,  8,  9,  8,  2, -1}, /*caso 199*/
  { 2,  5, 10,  2,  3,  5,  3,  7,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 200*/
  { 8,  2,  0,  8,  5,  2,  8,  7,  5, 10,  2,  5, -1, -1, -1, -1}, /*caso 201*/
  { 9,  0,  1,  5, 10,  3,  5,  3,  7,  3, 10,  2, -1, -1, -1, -1}, /*caso 202*/
  { 9,  8,  2,  9,  2,  1,  8,  7,  2, 10,  2,  5,  7,  5,  2, -1}, /*caso 203*/
  { 1,  3,  5,  3,  7,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 204*/
  { 0,  8,  7,  0,  7,  1,  1,  7,  5, -1, -1, -1, -1, -1, -1, -1}, /*caso 205*/
  { 9,  0,  3,  9,  3,  5,  5,  3,  7, -1, -1, -1, -1, -1, -1, -1}, /*caso 206*/
  { 9,  8,  7,  5,  9,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 207*/
  { 5,  8,  4,  5, 10,  8, 10, 11,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 208*/
  { 5,  0,  4,  5, 11,  0,  5, 10, 11, 11,  3,  0, -1, -1, -1, -1}, /*caso 209*/
  { 0,  1,  9,  8,  4, 10,  8, 10, 11, 10,  4,  5, -1, -1, -1, -1}, /*caso 210*/
  {10, 11,  4, 10,  4,  5, 11,  3,  4,  9,  4,  1,  3,  1,  4, -1}, /*caso 211*/
  { 2,  5,  1,  2,  8,  5,  2, 11,  8,  4,  5,  8, -1, -1, -1, -1}, /*caso 212*/
  { 0,  4, 11,  0, 11,  3,  4,  5, 11,  2, 11,  1,  5,  1, 11, -1}, /*caso 213*/
  { 0,  2,  5,  0,  5,  9,  2, 11,  5,  4,  5,  8, 11,  8,  5, -1}, /*caso 214*/
  { 9,  4,  5,  2, 11,  3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 215*/
  { 2,  5, 10,  3,  5,  2,  3,  4,  5,  3,  8,  4, -1, -1, -1, -1}, /*caso 216*/
  { 5, 10,  2,  5,  2,  4,  4,  2,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 217*/
  { 3, 10,  2,  3,  5, 10,  3,  8,  5,  4,  5,  8,  0,  1,  9, -1}, /*caso 218*/
  { 5, 10,  2,  5,  2,  4,  1,  9,  2,  9,  4,  2, -1, -1, -1, -1}, /*caso 219*/
  { 8,  4,  5,  8,  5,  3,  3,  5,  1, -1, -1, -1, -1, -1, -1, -1}, /*caso 220*/
  { 0,  4,  5,  1,  0,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 221*/
  { 8,  4,  5,  8,  5,  3,  9,  0,  5,  0,  3,  5, -1, -1, -1, -1}, /*caso 222*/
  { 9,  4,  5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 223*/
  { 4, 11,  7,  4,  9, 11,  9, 10, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 224*/
  { 0,  8,  3,  4,  9,  7,  9, 11,  7,  9, 10, 11, -1, -1, -1, -1}, /*caso 225*/
  { 1, 10, 11,  1, 11,  4,  1,  4,  0,  7,  4, 11, -1, -1, -1, -1}, /*caso 226*/
  { 3,  1,  4,  3,  4,  8,  1, 10,  4,  7,  4, 11, 10, 11,  4, -1}, /*caso 227*/
  { 4, 11,  7,  9, 11,  4,  9,  2, 11,  9,  1,  2, -1, -1, -1, -1}, /*caso 228*/
  { 9,  7,  4,  9, 11,  7,  9,  1, 11,  2, 11,  1,  0,  8,  3, -1}, /*caso 229*/
  {11,  7,  4, 11,  4,  2,  2,  4,  0, -1, -1, -1, -1, -1, -1, -1}, /*caso 230*/
  {11,  7,  4, 11,  4,  2,  8,  3,  4,  3,  2,  4, -1, -1, -1, -1}, /*caso 231*/
  { 2,  9, 10,  2,  7,  9,  2,  3,  7,  7,  4,  9, -1, -1, -1, -1}, /*caso 232*/
  { 9, 10,  7,  9,  7,  4, 10,  2,  7,  8,  7,  0,  2,  0,  7, -1}, /*caso 233*/
  { 3,  7, 10,  3, 10,  2,  7,  4, 10,  1, 10,  0,  4,  0, 10, -1}, /*caso 234*/
  { 1, 10,  2,  8,  7,  4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 235*/
  { 4,  9,  1,  4,  1,  7,  7,  1,  3, -1, -1, -1, -1, -1, -1, -1}, /*caso 236*/
  { 4,  9,  1,  4,  1,  7,  0,  8,  1,  8,  7,  1, -1, -1, -1, -1}, /*caso 237*/
  { 4,  0,  3,  7,  4,  3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 238*/
  { 4,  8,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 239*/
  { 9, 10,  8, 10, 11,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 240*/
  { 3,  0,  9,  3,  9, 11, 11,  9, 10, -1, -1, -1, -1, -1, -1, -1}, /*caso 241*/
  { 0,  1, 10,  0, 10,  8,  8, 10, 11, -1, -1, -1, -1, -1, -1, -1}, /*caso 242*/
  { 3,  1, 10, 11,  3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 243*/
  { 1,  2, 11,  1, 11,  9,  9, 11,  8, -1, -1, -1, -1, -1, -1, -1}, /*caso 244*/
  { 3,  0,  9,  3,  9, 11,  1,  2,  9,  2, 11,  9, -1, -1, -1, -1}, /*caso 245*/
  { 0,  2, 11,  8,  0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 246*/
  { 3,  2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 247*/
  { 2,  3,  8,  2,  8, 10, 10,  8,  9, -1, -1, -1, -1, -1, -1, -1}, /*caso 248*/
  { 9, 10,  2,  0,  9,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 249*/
  { 2,  3,  8,  2,  8, 10,  0,  1,  8,  1, 10,  8, -1, -1, -1, -1}, /*caso 250*/
  { 1, 10,  2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 251*/
  { 1,  3,  8,  9,  1,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 252*/
  { 0,  9,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 253*/
  { 0,  3,  8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}, /*caso 254*/
  {-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1}  /*caso 255*/
};

template <class TPVolumetricSpace>
unsigned int MarchingCubes<TPVolumetricSpace>::m_casemap[256] = {
  /* 0 */ 	0,
  /* 1 */ 	1,
  /* 2 */ 	8,
  /* 3 */ 	9,
  /* 4 */ 	16,
  /* 5 */ 	17,
  /* 6 */ 	24,
  /* 7 */ 	25,
  /* 8 */ 	128,
  /* 9 */ 	129,
  /* 10 */ 	136,
  /* 11 */ 	137,
  /* 12 */ 	144,
  /* 13 */ 	145,
  /* 14 */ 	152,
  /* 15 */ 	153,
  /* 16 */ 	2,
  /* 17 */ 	3,
  /* 18 */ 	10,
  /* 19 */ 	11,
  /* 20 */ 	18,
  /* 21 */ 	19,
  /* 22 */ 	26,
  /* 23 */ 	27,
  /* 24 */ 	130,
  /* 25 */ 	131,
  /* 26 */ 	138,
  /* 27 */ 	139,
  /* 28 */ 	146,
  /* 29 */ 	147,
  /* 30 */ 	154,
  /* 31 */ 	155,
  /* 32 */ 	4,
  /* 33 */ 	5,
  /* 34 */ 	12,
  /* 35 */ 	13,
  /* 36 */ 	20,
  /* 37 */ 	21,
  /* 38 */ 	28,
  /* 39 */ 	29,
  /* 40 */ 	132,
  /* 41 */ 	133,
  /* 42 */ 	140,
  /* 43 */ 	141,
  /* 44 */ 	148,
  /* 45 */ 	149,
  /* 46 */ 	156,
  /* 47 */ 	157,
  /* 48 */ 	6,
  /* 49 */ 	7,
  /* 50 */ 	14,
  /* 51 */ 	15,
  /* 52 */ 	22,
  /* 53 */ 	23,
  /* 54 */ 	30,
  /* 55 */ 	31,
  /* 56 */ 	134,
  /* 57 */ 	135,
  /* 58 */ 	142,
  /* 59 */ 	143,
  /* 60 */ 	150,
  /* 61 */ 	151,
  /* 62 */ 	158,
  /* 63 */ 	159,
  /* 64 */ 	32,
  /* 65 */ 	33,
  /* 66 */ 	40,
  /* 67 */ 	41,
  /* 68 */ 	48,
  /* 69 */ 	49,
  /* 70 */ 	56,
  /* 71 */ 	57,
  /* 72 */ 	160,
  /* 73 */ 	161,
  /* 74 */ 	168,
  /* 75 */ 	169,
  /* 76 */ 	176,
  /* 77 */ 	177,
  /* 78 */ 	184,
  /* 79 */ 	185,
  /* 80 */ 	34,
  /* 81 */ 	35,
  /* 82 */ 	42,
  /* 83 */ 	43,
  /* 84 */ 	50,
  /* 85 */ 	51,
  /* 86 */ 	58,
  /* 87 */ 	59,
  /* 88 */ 	162,
  /* 89 */ 	163,
  /* 90 */ 	170,
  /* 91 */ 	171,
  /* 92 */ 	178,
  /* 93 */ 	179,
  /* 94 */ 	186,
  /* 95 */ 	187,
  /* 96 */ 	36,
  /* 97 */ 	37,
  /* 98 */ 	44,
  /* 99 */ 	45,
  /* 100 */ 	52,
  /* 101 */ 	53,
  /* 102 */ 	60,
  /* 103 */ 	61,
  /* 104 */ 	164,
  /* 105 */ 	165,
  /* 106 */ 	172,
  /* 107 */ 	173,
  /* 108 */ 	180,
  /* 109 */ 	181,
  /* 110 */ 	188,
  /* 111 */ 	189,
  /* 112 */ 	38,
  /* 113 */ 	39,
  /* 114 */ 	46,
  /* 115 */ 	47,
  /* 116 */ 	54,
  /* 117 */ 	55,
  /* 118 */ 	62,
  /* 119 */ 	63,
  /* 120 */ 	166,
  /* 121 */ 	167,
  /* 122 */ 	174,
  /* 123 */ 	175,
  /* 124 */ 	182,
  /* 125 */ 	183,
  /* 126 */ 	190,
  /* 127 */ 	191,
  /* 128 */ 	64,
  /* 129 */ 	65,
  /* 130 */ 	72,
  /* 131 */ 	73,
  /* 132 */ 	80,
  /* 133 */ 	81,
  /* 134 */ 	88,
  /* 135 */ 	89,
  /* 136 */ 	192,
  /* 137 */ 	193,
  /* 138 */ 	200,
  /* 139 */ 	201,
  /* 140 */ 	208,
  /* 141 */ 	209,
  /* 142 */ 	216,
  /* 143 */ 	217,
  /* 144 */ 	66,
  /* 145 */ 	67,
  /* 146 */ 	74,
  /* 147 */ 	75,
  /* 148 */ 	82,
  /* 149 */ 	83,
  /* 150 */ 	90,
  /* 151 */ 	91,
  /* 152 */ 	194,
  /* 153 */ 	195,
  /* 154 */ 	202,
  /* 155 */ 	203,
  /* 156 */ 	210,
  /* 157 */ 	211,
  /* 158 */ 	218,
  /* 159 */ 	219,
  /* 160 */ 	68,
  /* 161 */ 	69,
  /* 162 */ 	76,
  /* 163 */ 	77,
  /* 164 */ 	84,
  /* 165 */ 	85,
  /* 166 */ 	92,
  /* 167 */ 	93,
  /* 168 */ 	196,
  /* 169 */ 	197,
  /* 170 */ 	204,
  /* 171 */ 	205,
  /* 172 */ 	212,
  /* 173 */ 	213,
  /* 174 */ 	220,
  /* 175 */ 	221,
  /* 176 */ 	70,
  /* 177 */ 	71,
  /* 178 */ 	78,
  /* 179 */ 	79,
  /* 180 */ 	86,
  /* 181 */ 	87,
  /* 182 */ 	94,
  /* 183 */ 	95,
  /* 184 */ 	198,
  /* 185 */ 	199,
  /* 186 */ 	206,
  /* 187 */ 	207,
  /* 188 */ 	214,
  /* 189 */ 	215,
  /* 190 */ 	222,
  /* 191 */ 	223,
  /* 192 */ 	96,
  /* 193 */ 	97,
  /* 194 */ 	104,
  /* 195 */ 	105,
  /* 196 */ 	112,
  /* 197 */ 	113,
  /* 198 */ 	120,
  /* 199 */ 	121,
  /* 200 */ 	224,
  /* 201 */ 	225,
  /* 202 */ 	232,
  /* 203 */ 	233,
  /* 204 */ 	240,
  /* 205 */ 	241,
  /* 206 */ 	248,
  /* 207 */ 	249,
  /* 208 */ 	98,
  /* 209 */ 	99,
  /* 210 */ 	106,
  /* 211 */ 	107,
  /* 212 */ 	114,
  /* 213 */ 	115,
  /* 214 */ 	122,
  /* 215 */ 	123,
  /* 216 */ 	226,
  /* 217 */ 	227,
  /* 218 */ 	234,
  /* 219 */ 	235,
  /* 220 */ 	242,
  /* 221 */ 	243,
  /* 222 */ 	250,
  /* 223 */ 	251,
  /* 224 */ 	100,
  /* 225 */ 	101,
  /* 226 */ 	108,
  /* 227 */ 	109,
  /* 228 */ 	116,
  /* 229 */ 	117,
  /* 230 */ 	124,
  /* 231 */ 	125,
  /* 232 */ 	228,
  /* 233 */ 	229,
  /* 234 */ 	236,
  /* 235 */ 	237,
  /* 236 */ 	244,
  /* 237 */ 	245,
  /* 238 */ 	252,
  /* 239 */ 	253,
  /* 240 */ 	102,
  /* 241 */ 	103,
  /* 242 */ 	110,
  /* 243 */ 	111,
  /* 244 */ 	118,
  /* 245 */ 	119,
  /* 246 */ 	126,
  /* 247 */ 	127,
  /* 248 */ 	230,
  /* 249 */ 	231,
  /* 250 */ 	238,
  /* 251 */ 	239,
  /* 252 */ 	246,
  /* 253 */ 	247,
  /* 254 */ 	254,
  /* 255 */ 	255
};


CGL_END

#endif